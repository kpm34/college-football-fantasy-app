<!DOCTYPE html>
<html>
<head>
    <title>Debug Commissioner Status</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
</head>
<body>
    <h1>Commissioner Status Debug</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        
        async function debugCommissioner() {
            const { Client, Databases, Account } = Appwrite;
            
            // Initialize Appwrite
            const client = new Client()
                .setEndpoint('https://nyc.cloud.appwrite.io/v1')
                .setProject('college-football-fantasy-app');
            
            const databases = new Databases(client);
            const account = new Account(client);
            
            try {
                // Get current user
                let currentUser = null;
                try {
                    currentUser = await account.get();
                    output.innerHTML += `<p><strong>Current User:</strong></p>`;
                    output.innerHTML += `<pre>${JSON.stringify(currentUser, null, 2)}</pre>`;
                } catch (e) {
                    output.innerHTML += `<p style="color:red">Not logged in</p>`;
                    return;
                }
                
                // Get league data
                const leagueId = '6894db4a0001ad84e4b0';
                const league = await databases.getDocument(
                    'college-football-fantasy',
                    'leagues',
                    leagueId
                );
                
                output.innerHTML += `<p><strong>League Data:</strong></p>`;
                output.innerHTML += `<pre>${JSON.stringify({
                    name: league.name,
                    commissionerId: league.commissionerId,
                    commissioner: league.commissioner,
                    status: league.status
                }, null, 2)}</pre>`;
                
                // Check if commissioner
                const isCommissioner = 
                    league.commissionerId === currentUser.$id ||
                    league.commissioner === currentUser.name ||
                    league.commissioner?.toLowerCase() === currentUser.name?.toLowerCase();
                
                output.innerHTML += `<p><strong>Commissioner Check:</strong></p>`;
                output.innerHTML += `<ul>`;
                output.innerHTML += `<li>League commissionerId: ${league.commissionerId}</li>`;
                output.innerHTML += `<li>League commissioner: ${league.commissioner}</li>`;
                output.innerHTML += `<li>User $id: ${currentUser.$id}</li>`;
                output.innerHTML += `<li>User name: ${currentUser.name}</li>`;
                output.innerHTML += `<li><strong>Is Commissioner: ${isCommissioner ? 'YES' : 'NO'}</strong></li>`;
                output.innerHTML += `</ul>`;
                
                if (isCommissioner) {
                    output.innerHTML += `<p style="color:green"><strong>✓ You should see the Commish button!</strong></p>`;
                } else {
                    output.innerHTML += `<p style="color:red"><strong>✗ Commissioner check failed</strong></p>`;
                }
                
            } catch (error) {
                output.innerHTML += `<p style="color:red">Error: ${error.message}</p>`;
            }
        }
        
        // Run the debug
        debugCommissioner();
    </script>
</body>
</html>
