<mxfile host="app.diagrams.net" modified="2025-09-03T00:00:00.000Z" agent="AI" version="22.0.0" editor="www.diagrams.net">
  <diagram id="draft-autopick-system" name="Draft Autopick System">
    <mxGraphModel dx="1280" dy="720" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1920" pageHeight="1080" background="#FFFFFF">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <mxCell id="title" value="Draft Autopick System" style="rounded=1;whiteSpace=wrap;html=1;fontSize=22;fontStyle=1;fillColor=#FDF4FF;strokeColor=#A21CAF;fontColor=#6D28D9;align=center;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="40" y="20" width="520" height="60" as="geometry"/>
        </mxCell>

        <!-- Flow: Primary Timer Expiration -->
        <mxCell id="sec_primary" value="Primary: Timer Expiration" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontStyle=1;fillColor=#FEE2E2;strokeColor=#DC2626;fontColor=#7F1D1D;" vertex="1" parent="1">
          <mxGeometry x="40" y="100" width="480" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="p1" value="UI: Timer hits 0" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3F4F6;strokeColor=#374151;fontColor=#111827;" vertex="1" parent="1">
          <mxGeometry x="40" y="150" width="220" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="p2" value="POST /api/drafts/:id/autopick" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#1E3A8A;fontColor=#1E3A8A;" vertex="1" parent="1">
          <mxGeometry x="280" y="150" width="240" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="p3" value="DB: lock → validate → execute → write → next → release" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F0F9FF;strokeColor=#0284C7;fontColor=#0C4A6E;" vertex="1" parent="1">
          <mxGeometry x="40" y="210" width="480" height="60" as="geometry"/>
        </mxCell>

        <!-- Flow: Secondary Serverless -->
        <mxCell id="sec_secondary" value="Secondary: Serverless Fallback" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontStyle=1;fillColor=#EFF6FF;strokeColor=#0EA5E9;fontColor=#0C4A6E;" vertex="1" parent="1">
          <mxGeometry x="560" y="100" width="520" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="s1" value="DB event: draft_states update" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ECFEFF;strokeColor=#06B6D4;fontColor=#0E7490;" vertex="1" parent="1">
          <mxGeometry x="560" y="150" width="520" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="s2" value="Fn scans expired timers → POST autopick" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ECFEFF;strokeColor=#06B6D4;fontColor=#0E7490;" vertex="1" parent="1">
          <mxGeometry x="560" y="210" width="520" height="50" as="geometry"/>
        </mxCell>

        <!-- Flow: Tertiary Cron -->
        <mxCell id="sec_tertiary" value="Tertiary: Cron Safety Net (every minute)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontStyle=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontColor=#92400E;" vertex="1" parent="1">
          <mxGeometry x="40" y="300" width="520" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="t1" value="Cron: query deadline < now()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontColor=#92400E;" vertex="1" parent="1">
          <mxGeometry x="40" y="350" width="520" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="t2" value="POST /api/drafts/:id/autopick (batch)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#1E3A8A;fontColor=#1E3A8A;" vertex="1" parent="1">
          <mxGeometry x="40" y="410" width="520" height="50" as="geometry"/>
        </mxCell>

        <!-- Strategies -->
        <mxCell id="str_title" value="Autopick Strategies" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontStyle=1;fillColor=#FDF4FF;strokeColor=#A21CAF;fontColor=#6D28D9;" vertex="1" parent="1">
          <mxGeometry x="600" y="300" width="480" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="str_bpa" value="BPA: select highest-ranked available" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#A21CAF;fontColor=#6D28D9;" vertex="1" parent="1">
          <mxGeometry x="600" y="350" width="480" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="str_bal" value="Balanced: value × position needs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#A21CAF;fontColor=#6D28D9;" vertex="1" parent="1">
          <mxGeometry x="600" y="410" width="480" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="str_need" value="Need-based: fill roster gaps first" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#A21CAF;fontColor=#6D28D9;" vertex="1" parent="1">
          <mxGeometry x="600" y="470" width="480" height="50" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>